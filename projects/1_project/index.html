<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Database Structure | Tzvi Aviv</title> <meta name="author" content="Tzvi Aviv"> <meta name="description" content="Database Design With Entity-Relationship Diagram"> <meta name="keywords" content="Tzvi Aviv, jekyll, jekyll-theme, academic-website, portfolio-website"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.css"> <link rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?19f3075a2d19613090fe9e16b564e1fe" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://taviv.github.io/projects/1_project/"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?e74e74bf055e5729d44a7d031a5ca6a5" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?96d6b3e1c3604aca8b6134c7afdd5db6"></script> <script src="/assets/js/dark_mode.js?9b17307bb950ffa2e34be0227f53558f"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"><span class="font-weight-bold">Tzvi </span>Aviv</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about</a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">blog</a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications</a> </li> <li class="nav-item active"> <a class="nav-link" href="/projects/">projects<span class="sr-only">(current)</span></a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">repositories</a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv</a> </li> <li class="nav-item "> <a class="nav-link" href="/teaching/">teaching</a> </li> <li class="nav-item "> <a class="nav-link" href="/people/">people</a> </li> <li class="nav-item dropdown "> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">submenus</a> <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown"> <a class="dropdown-item " href="/publications/">publications</a> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/projects/">projects</a> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/blog/">blog</a> </div> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fa-solid fa-moon"></i> <i class="fa-solid fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">Database Structure</h1> <p class="post-description">Database Design With Entity-Relationship Diagram</p> </header> <article> <h2 id="synopsis">Synopsis</h2> <p>Database design for a ‘Connected Health’ business strategy at an extensive pharmacy network.</p> <h2 id="situation">Situation</h2> <p>Recent changes in provincial regulations in Canada enable pharmacists to provide a growing list of medical services including: vaccinations, medical reviews, and treatments for minor ailments, in addition to their traditional role as prescription dispensers. Importantly, primary pharmacy IT systems deployed in the network are decentralized (each pharmacy is an independent unit) and transactional (capturing transactions at the pharmacy and not designed for patient treatments). How may the network mine rich historical data captured in thousands of pharmacies? Can a central and patient-centric system better support the emerging roles of pharmacists? Can we support patients receiving treatment in multiple pharmacies? Can we measure the health outcomes of patients and make proper recommendations for products and services?</p> <p>&lt;/div&gt;</p> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset=" /assets/img/pharmacy_erd-480.webp 480w, /assets/img/pharmacy_erd-800.webp 800w, /assets/img/pharmacy_erd-1400.webp 1400w, " sizes="95vw" type="image/webp"></source> <img src="/assets/img/pharmacy_erd.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="database erd" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> Schematic Entity-Relationship Diagram (ERD) of augmented pharmacy data in Lucidchart. </div> <h2 id="architecture-solution">Architecture Solution</h2> <p>At the core, I designed three tables (as depicted above) curated from pharmacy transaction systems across Canada using an efficient and semi-automatic data pipeline (written in Python/SQL):</p> <ol> <li>Patient Table: containing all patient profiles curated from all systems (about 60 million rows).</li> <li>Store Table: containing data on all pharmacy stores (about 2,000 rows).</li> <li>Prescription transaction table: data captured by prescription dispensing (billions of rows). Services Table: Medical services provided by pharmacists. I augmented these large tables with smaller tables curated from public sources and commercial vendors in coordination with additional enterprise teams:</li> <li>Health Products Table: Health Canada published database of all pharmaceuticals approved for sale in Canada.</li> <li>Healthcare Providers Table: Sourced from medical professional colleges in each province and/or from a third-party vendor (IQVIA).</li> <li>PC Health Kiosk table: Curated by a third-party vendor from blood pressure kiosks deployed at pharmacies.</li> <li>Afinion Table: Hemoglobin A1C and Lipid values captured in pharmacies using Afinion devices and curated by a third-party vendor.</li> <li>Canadian Community Health Survey (CCHS): Sourced from Statistics Canada and includes FSA aggregated health data.</li> <li>Digital patient surveys: Monthly surveys designed to capture intentions to vaccinate or measure blood pressure and deployed by a third-party vendor.</li> </ol> <h1 id="advantages-and-limitations">Advantages and limitations</h1> <p>This architecture was a key component in adopting modern agile data science practices. Consolidated pre-cleaned tables replaced thousands of columns (many redundant or unnecessary) of ‘dirty data’ in a traditional SQL server. Sensitive data fields (such as emails and phone numbers) are encrypted for privacy compliance, and data access is strictly governed using Google’s IAM policies and service accounts. Deployment of these tables in Google’s BigQuery platform (scalable with data size) plus the adoption of virtual machines for data processing, Looker for visualizations, and code repos for code preservation enabled my team to complete analytic tasks and projects faster. For example, targeting patients eligible for vaccination services by age and chronic condition that used to run for hours and sometimes end in spooling errors are now delivered in minutes and can be automated in the visualization platform. Furthermore, tasks considered impossible, such as linking Hemoglobin A1C results with pharmaceutical records (without a unified and consistent patient identifier), became feasible with new patient identity resolution methods developed by my team.</p> <h2 id="cloud-platform">Cloud Platform</h2> <p>While we implemented this architecture in the Google Cloud Platform, these tables can be transferred to other cloud providers, such as AWS or Azure. However, a cloud switch will triger significant code revisions in pipelines and downstream applications, a multi-cloud solution vendor should be considered to avoid risks from a single cloud vendor.</p> <h2 id="interoperability">Interoperability</h2> <p>A key limitation of this data architecture is not adhering to conventional patient data standards such as HL7 FHIR (Fast Healthcare Interoperability Resources). Adopting consistent healthcare data standards at the source pharmacy systems or during data collection will improve systems interoperability and should be encouraged in future iterations.</p> </article> </div> </div> <footer class="fixed-bottom"> <div class="container mt-0"> © Copyright 2024 Tzvi Aviv. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?7b30caa5023af4af8408a472dc4e1ebb"></script> <script defer src="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.js"></script> <script src="/assets/js/no_defer.js?d633890033921b33e0ceb13d22340a9c"></script> <script defer src="/assets/js/common.js?acdb9690d7641b2f8d40529018c71a01"></script> <script defer src="/assets/js/copy_code.js?07b8786bab9b4abe90d10e61f7d12ff7" type="text/javascript"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>